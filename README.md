# AIMakesPlans
AIé©±åŠ¨çš„æ—¶é—´ç®¡ç†é©å‘½ï¼šè®© LLM æˆä¸ºä½ çš„æ™ºèƒ½æ—¥ç¨‹åŠ©ç†ï¼Œè´Ÿè´£"ç†è§£éœ€æ±‚ â†’ æ™ºèƒ½æ’æœŸ â†’ å†²çªè§„é¿ â†’ åŠ¨æ€è·Ÿè¿›"ï¼Œå¸®åŠ©ä½ ä¸“æ³¨äºçœŸæ­£é‡è¦çš„äº‹ã€‚

## ğŸš€ å½“å‰å¼€å‘è¿›åº¦

### âœ… å·²å®Œæˆçš„é˜¶æ®µ

**ç¬¬ä¸€é˜¶æ®µï¼šåç«¯APIåŸºç¡€æ¶æ„**
- âœ… FastAPIåº”ç”¨éª¨æ¶å’Œå¥åº·æ£€æŸ¥æ¥å£
- âœ… å®Œæ•´çš„æ•°æ®æ¨¡å‹å®šä¹‰ï¼ˆTask, Event, UserPreferenceç­‰ï¼‰
- âœ… v1ç‰ˆæœ¬APIè·¯ç”±å®ç°ï¼ˆtasks, parse, scheduleï¼‰
- âœ… APIæ–‡æ¡£ï¼ˆSwagger/ReDocï¼‰
- âœ… CORSæ”¯æŒ

**ç¬¬äºŒé˜¶æ®µï¼šLLMæœåŠ¡ä¸æç¤ºè¯å·¥ç¨‹**
- âœ… LLMæœåŠ¡å°è£…ï¼ˆæ”¯æŒSiliconFlow/OpenAIç­‰ï¼‰
- âœ… è‡ªç„¶è¯­è¨€ä»»åŠ¡è§£æï¼ˆä¸­æ–‡æ”¯æŒï¼‰
- âœ… æ™ºèƒ½æç¤ºè¯æ¨¡æ¿
- âœ… ç½®ä¿¡åº¦è¯„ä¼°
- âœ… çœŸå®APIè°ƒç”¨æµ‹è¯•é€šè¿‡

**ç¬¬ä¸‰é˜¶æ®µï¼šå†²çªæ£€æµ‹ä¸è°ƒåº¦ç®—æ³•**
- âœ… æ—¶é—´é‡å æ£€æµ‹ç®—æ³•
- âœ… å†²çªå‘ç°ä¸æŠ¥å‘Š
- âœ… ç©ºé—²æ—¶é—´æ§½æŸ¥æ‰¾
- âœ… æ™ºèƒ½ä»»åŠ¡è°ƒåº¦ï¼ˆæ”¯æŒEisenhowerå’ŒFIFOç­–ç•¥ï¼‰
- âœ… ç”¨æˆ·åå¥½çº¦æŸï¼ˆå·¥ä½œæ—¶é—´ã€å…æ‰“æ‰°ã€ç¼“å†²æ—¶é—´ç­‰ï¼‰

### ğŸ“Š é¡¹ç›®ç»Ÿè®¡

- **æµ‹è¯•é€šè¿‡ç‡ï¼š** 100% (84/84ä¸ªæµ‹è¯•) âœ…
- **ä»£ç æ¨¡å—ï¼š** 10ä¸ªæ ¸å¿ƒæœåŠ¡æ¨¡å—
- **APIç«¯ç‚¹ï¼š** 8ä¸ªå®Œæ•´å®ç°
- **æ•°æ®æ¨¡å‹ï¼š** 19ä¸ªPydanticæ¨¡å‹

### ğŸ¯ å½“å‰çŠ¶æ€

**ç³»ç»ŸåŠŸèƒ½ï¼š** æ ¸å¿ƒMVPåŠŸèƒ½å·²å…¨éƒ¨å®ç° ğŸ‰
- âœ… è‡ªç„¶è¯­è¨€ç†è§£ï¼ˆ"æ˜å¤©ä¸‹åˆåš2å°æ—¶æŠ¥å‘Š" â†’ ç»“æ„åŒ–ä»»åŠ¡ï¼‰
- âœ… æ™ºèƒ½å†²çªæ£€æµ‹ï¼ˆå›ºå®šä»»åŠ¡æ—¶é—´å†²çªè¯†åˆ«ï¼‰
- âœ… è‡ªåŠ¨ä»»åŠ¡è°ƒåº¦ï¼ˆçµæ´»ä»»åŠ¡æ™ºèƒ½æ’æœŸï¼‰
- âœ… ç”¨æˆ·åå¥½ç®¡ç†ï¼ˆå·¥ä½œæ—¶é—´ã€ä¼˜å…ˆçº§ç­–ç•¥ç­‰ï¼‰

**è¿è¡ŒçŠ¶æ€ï¼š** æœåŠ¡å™¨è¿è¡Œåœ¨ http://127.0.0.1:8000  
**APIæ–‡æ¡£ï¼š** http://127.0.0.1:8000/docs

**ä¸‹ä¸€æ­¥ï¼š** å‰ç«¯Webç•Œé¢å¼€å‘ã€ICSé›†æˆã€æ•°æ®æŒä¹…åŒ–

---

### åŠŸèƒ½æ¦‚è§ˆï¼ˆMVPï¼‰

- **è‡ªç„¶è¯­è¨€åˆ›å»ºä»»åŠ¡**ï¼šæ”¯æŒå£è¯­åŒ–è¾“å…¥ï¼ˆå¦‚â€œæ˜å¤©ä¸‹åˆåš2å°æ—¶æŠ¥å‘Šâ€ï¼‰â†’ è§£æä¸ºç»“æ„åŒ–æ•°æ®ï¼ˆæ ‡é¢˜ã€æ—¶é•¿ã€æ—¶é—´åå¥½ã€ä¼˜å…ˆçº§ç­‰ï¼‰ã€‚
- **å†²çªæ£€æµ‹ä¸çµæ´»è°ƒåº¦**ï¼šè‡ªåŠ¨è¯†åˆ«é‡å æ—¶é—´ï¼ŒåŸºäºç”¨æˆ·åå¥½ä¸ä¼˜å…ˆçº§ï¼ŒæŠŠçµæ´»ä»»åŠ¡å®‰æ’åˆ°åˆé€‚ç©ºé—²æ—¶æ®µã€‚
- **ç”¨æˆ·åå¥½ä¸çŠ¶æ€**ï¼šå·¥ä½œ/ä¼‘æ¯/ä¸å¯ç”¨æ—¶æ®µã€æœ€å¤§ä¸“æ³¨æ—¶é•¿ã€ç¼“å†²æ—¶é—´ã€å¿™ç¢Œ/ç©ºé—²ã€ä¼‘æ¯æ¨¡å¼ã€‚
- **ä¼˜å…ˆçº§ç­–ç•¥**ï¼šæ”¯æŒâ€œç´§æ€¥-é‡è¦çŸ©é˜µï¼ˆEisenhowerï¼‰â€ä¸â€œå…ˆæ¥ååˆ°ï¼ˆFIFOï¼‰â€åˆ‡æ¢ã€‚
- **è¿›åº¦è·Ÿè¿›**ï¼šä»»åŠ¡ç»“æŸå‰åæé†’ï¼›æœªå®Œæˆçš„çµæ´»ä»»åŠ¡è‡ªåŠ¨é‡æ–°æ’æœŸã€‚
- **å¯è§†åŒ–ï¼ˆåŸºç¡€ï¼‰**ï¼šWeb é¡µé¢å±•ç¤ºå¥åº·æ£€æŸ¥ã€è§£æç»“æœã€è§„åˆ’æ–¹æ¡ˆï¼ˆå¯ä»ç®€å•è¡¨æ ¼æˆ–å‘¨è§†å›¾å¼€å§‹ï¼‰ã€‚
- **ICSï¼ˆå¯é€‰ï¼‰**ï¼šå¯¼å…¥/å¯¼å‡º iCalendarï¼Œå…¼å®¹ä¸»æµæ—¥å†ã€‚

### ç³»ç»Ÿæ¶æ„ï¼ˆå»ºè®®ï¼‰

- **åç«¯ï¼ˆPython / FastAPIï¼‰**ï¼š
  - è·¯ç”±ï¼š`/health`ã€`/v1/parse`ã€`/v1/tasks`ã€`/v1/schedule/plan`ã€`/v1/ics/*`ã€`/v1/user/*`
  - æœåŠ¡å±‚ï¼šLLM å°è£…ã€è§£æã€å†²çªæ£€æµ‹ã€è°ƒåº¦ã€ICS å·¥å…·
  - æŒä¹…åŒ–ï¼šMVP å¯å†…å­˜/æ–‡ä»¶ï¼›æ¨è SQLite + SQLAlchemy + Alembicï¼ˆåç»­å¯åˆ‡æ¢ Postgresï¼‰

- **å‰ç«¯ï¼ˆWebï¼‰**ï¼š
  - æœ€å°é™æ€ç«™ï¼š`index.html + app.js + styles.css`
  - ä¸åç«¯æ¥å£æ‰“é€šï¼Œå±•ç¤ºè§£æç»“æœä¸æ’æœŸæ–¹æ¡ˆ

### ç›®å½•è§„åˆ’ï¼ˆå»ºè®®ï¼‰

```
backend/
  app/
    main.py
    core/config.py
    api/v1/
      parse.py
      tasks.py
      schedule.py
      ics.py
      user.py
    models/schemas.py
    services/
      llm_service.py
      parsing.py
      conflicts.py
      scheduling.py
      ics_tools.py
    persistence/
      repo.py
  tests/
    test_api.py
    test_parsing.py
    test_conflicts.py
    test_scheduling.py
frontend/
  web/
    index.html
    app.js
    styles.css
```

### å¿«é€Ÿå¼€å§‹

#### 1. å…‹éš†é¡¹ç›®

```bash
git clone https://github.com/yourusername/AIMakesPlans.git
cd AIMakesPlans
```

#### 2. åˆ›å»º Conda ç¯å¢ƒ

```bash
conda create -n project_ai_makes_plans python=3.11
conda activate project_ai_makes_plans
```

#### 3. å®‰è£…ä¾èµ–

```bash
pip install -r requirements.txt
```

#### 4. é…ç½®ç¯å¢ƒå˜é‡ â­ é‡è¦

**æ–¹å¼1ï¼šå¤åˆ¶æ¨¡æ¿æ–‡ä»¶**
```bash
# Windows PowerShell
copy .env.example .env

# Linux/macOS
cp .env.example .env
```

**æ–¹å¼2ï¼šæ‰‹åŠ¨åˆ›å»º .env æ–‡ä»¶**

åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»º `.env` æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š

```env
# LLM Provider Configuration
LLM_PROVIDER=siliconflow
LLM_MODEL=Qwen/Qwen2.5-7B-Instruct
LLM_BASE_URL=https://api.siliconflow.cn/v1
MAX_TOKENS=4096

# API Key - åœ¨è¿™é‡Œå¡«å…¥ä½ çš„ç¡…åŸºæµåŠ¨ API Key
OPENAI_API_KEY=your-api-key-here

# Server Configuration
PORT=8000
HOST=0.0.0.0

# Priority Policy
PRIORITY_POLICY=eisenhower
```

**è·å– API Keyï¼š**
- è®¿é—®ï¼šhttps://siliconflow.cn/
- æ³¨å†Œè´¦å·å¹¶è·å– API Key
- å°† API Key æ›¿æ¢åˆ° `.env` æ–‡ä»¶ä¸­çš„ `OPENAI_API_KEY`

#### 5. å¯åŠ¨åç«¯æœåŠ¡

```bash
# åœ¨é¡¹ç›®æ ¹ç›®å½•è¿è¡Œ
uvicorn backend.app.main:app --reload --host 127.0.0.1 --port 8000
```

å¯åŠ¨æˆåŠŸåï¼Œä½ ä¼šçœ‹åˆ°ï¼š
```
INFO:     Uvicorn running on http://127.0.0.1:8000 (Press CTRL+C to quit)
INFO:     Started reloader process
INFO:     Started server process
INFO:     Application startup complete.
```

#### 6. è®¿é—® API æ–‡æ¡£

æ‰“å¼€æµè§ˆå™¨è®¿é—®ï¼š
- **Swagger UI**: http://127.0.0.1:8000/docs ï¼ˆæ¨èï¼Œå¯ç›´æ¥æµ‹è¯•APIï¼‰
- **ReDoc**: http://127.0.0.1:8000/redoc
- **å¥åº·æ£€æŸ¥**: http://127.0.0.1:8000/health

#### 7. æµ‹è¯• APIï¼ˆå¯é€‰ï¼‰

```bash
# è¿è¡Œæ‰€æœ‰å•å…ƒæµ‹è¯•
pytest backend/tests/ -v -m "not integration"

# è¿è¡Œé›†æˆæµ‹è¯•ï¼ˆéœ€è¦çœŸå®APIè°ƒç”¨ï¼‰
pytest backend/tests/test_parsing_integration.py -v

# è¿è¡Œç‰¹å®šæµ‹è¯•
pytest backend/tests/test_api.py -v
pytest backend/tests/test_llm_service.py -v
```

### ç¯å¢ƒå˜é‡ï¼ˆç¤ºä¾‹ï¼‰

```
LLM_PROVIDER=openai
LLM_API_KEY=sk-xxx
LLM_BASE_URL=https://api.openai.com/v1
PORT=8000
PRIORITY_POLICY=eisenhower   # eisenhower|fifo
```

### API æ¦‚è§ˆï¼ˆè‰æ¡ˆï¼‰

- `GET  /health`ï¼šå¥åº·æ£€æŸ¥ â†’ `{status:"ok"}`
- `POST /v1/parse`ï¼šè‡ªç„¶è¯­è¨€ â†’ ç»“æ„åŒ–ä»»åŠ¡ï¼ˆä¾èµ– LLMï¼‰
- `POST /v1/tasks`ï¼šåˆ›å»º/ä¿å­˜ä»»åŠ¡ï¼ˆMVP å¯å†…å­˜/æ–‡ä»¶ï¼‰
- `POST /v1/schedule/plan`ï¼šè¾“å…¥ç°æœ‰äº‹ä»¶/åå¥½/å¾…æ’ä»»åŠ¡ â†’ è§„åˆ’æ–¹æ¡ˆ
- `POST /v1/ics/import`ã€`GET /v1/ics/export`ï¼šå¯¼å…¥/å¯¼å‡º ICSï¼ˆå¯é€‰ï¼‰
- `GET/PUT /v1/user/preferences`ï¼šè¯»å–/æ›´æ–°ç”¨æˆ·åå¥½
- `GET/PUT /v1/user/status`ï¼šè¯»å–/æ›´æ–°ç”¨æˆ·çŠ¶æ€ï¼ˆbusy/idleã€restModeï¼‰

### æç¤ºè¯é©±åŠ¨çš„å®æ–½æ­¥éª¤

å°†æ¯ä¸€æ­¥çš„â€œæç¤ºè¯â€å¤åˆ¶åˆ°ä½ çš„ LLMï¼ˆå¦‚ Cursor/ChatGPT/Claudeï¼‰ï¼Œè®©å…¶äº§å‡ºä»£ç æ”¹åŠ¨ã€‚æ¯æ­¥å®Œæˆåç«‹åˆ»è¿›è¡Œâ€œæµ‹è¯•æ–¹å¼â€ã€‚

1) é¡¹ç›®åˆå§‹åŒ–ï¼ˆåç«¯ & å‰ç«¯ï¼‰

æç¤ºè¯ï¼š
```
è¯·åˆ›å»º FastAPI åç«¯éª¨æ¶ï¼š
- backend/app/main.pyï¼šæä¾› GET /health è¿”å› {"status":"ok"}
- backend/app/core/config.pyï¼šè¯»å– .envï¼ˆPORTã€LLM_PROVIDERã€LLM_API_KEYï¼‰
- backend/tests/test_api.pyï¼šå¯¹ /health è¿›è¡Œé›†æˆæµ‹è¯•ï¼ˆTestClientï¼‰
å¹¶åˆ›å»ºæœ€å°å‰ç«¯ï¼šfrontend/web/{index.html, app.js, styles.css}ï¼Œè°ƒç”¨ /health å¹¶å±•ç¤ºç»“æœã€‚
ç»™å‡ºå®‰è£…ä¾èµ–ã€å¯åŠ¨å‘½ä»¤ä¸ pytest å‘½ä»¤ã€‚
```

æµ‹è¯•æ–¹å¼ï¼š
- `uvicorn backend.app.main:app --reload`ï¼›æµè§ˆå™¨ `GET /health` è¿”å› `{"status":"ok"}`
- `pytest -q backend/tests/test_api.py` é€šè¿‡

2) æ•°æ®æ¨¡å‹ä¸åŸºç¡€ API

æç¤ºè¯ï¼š
```
åœ¨ backend/app/models/schemas.py å®šä¹‰ï¼š
- Priorityï¼ˆP0..P3ï¼‰
- Task/Event/UserPreference/UserStatus/PriorityPolicy/Conflict/SchedulePlan
å®ç°å ä½è·¯ç”±ï¼šPOST /v1/parseã€/v1/tasksã€/v1/schedule/planï¼Œå¹¶åœ¨ main.py ä¸­æŒ‚è½½ã€‚
æä¾›ï¼šç¤ºä¾‹è¯·æ±‚/å“åº”ã€pydantic æ ¡éªŒå•æµ‹ã€‚
```

æµ‹è¯•æ–¹å¼ï¼š
- `pytest -q backend/tests/test_schemas.py`ï¼›ç”¨ httpx/TestClient æ–­è¨€ 200 ä¸ schemaã€‚

3) LLM å°è£…ä¸æç¤ºè¯å·¥ç¨‹

æç¤ºè¯ï¼š
```
å®ç° services/llm_service.pyï¼š
- å…¼å®¹ OpenAI /v1/chat/completionsï¼›è¯»å– LLM_PROVIDERã€LLM_API_KEYã€LLM_BASE_URL
- æä¾› invoke_chat()ã€parse_text_to_task(text, preference)
- ä½¿ç”¨ monkeypatch/mock æ›¿ä»£çœŸå®ç½‘ç»œï¼Œç¼–å†™å•æµ‹
```

æµ‹è¯•æ–¹å¼ï¼š
- å¯¹ invoke_chat åš monkeypatchï¼Œè¿”å›å›ºå®š JSONï¼›æ–­è¨€ parse_text_to_task ç»“æ„æ­£ç¡®ã€‚

4) è‡ªç„¶è¯­è¨€è§£æ API

æç¤ºè¯ï¼š
```
å®ç° services/parsing.py ä¸ api/v1/parse.pyï¼š
- POST /v1/parse æ¥æ”¶ {text, preference}ï¼Œè°ƒç”¨ llm_serviceï¼Œè¿”å› Task
- é”™è¯¯è¾“å…¥è¿”å› 4xxï¼ŒåŒ…å«é”™è¯¯ä¿¡æ¯
```

æµ‹è¯•æ–¹å¼ï¼š
- `pytest -q backend/tests/test_parsing.py`ï¼›httpx æµ‹è¯•æˆåŠŸä¸å¤±è´¥ç”¨ä¾‹ã€‚

5) å†²çªæ£€æµ‹ä¸è°ƒåº¦

æç¤ºè¯ï¼š
```
å®ç° conflicts.overlap(a,b) ä¸ scheduling.plan(tasks, events, preferences, status)
- å†²çªè§„åˆ™ï¼šstart_new < end_exist && end_new > start_exist
- çº¦æŸï¼šä¸å¯ç”¨æ—¶æ®µã€æœ€å°å—ã€ç¼“å†²ã€maxFocusDurationã€restMode/busyã€ä¼˜å…ˆçº§ä¸æˆªæ­¢æ—¶é—´æ’åº
```

æµ‹è¯•æ–¹å¼ï¼š
- `pytest -q backend/tests/test_conflicts.py backend/tests/test_scheduling.py`

6) ICS é›†æˆï¼ˆå¯é€‰ï¼‰

æç¤ºè¯ï¼š
```
æ·»åŠ  /v1/ics/import ä¸ /v1/ics/exportï¼›ä½¿ç”¨å†…å­˜æ–‡ä»¶è¿›è¡Œå•æµ‹ã€‚
```

7) å‰ç«¯å¯¹æ¥

æç¤ºè¯ï¼š
```
åœ¨å‰ç«¯æä¾›è¾“å…¥æ¡†ï¼š
- è°ƒç”¨ /v1/parse å±•ç¤ºç»“æ„åŒ–ç»“æœ
- è°ƒç”¨ /v1/schedule/plan å±•ç¤ºå€™é€‰æ–¹æ¡ˆä¸å†²çªæç¤º
```

### æµ‹è¯•æ–¹æ³•ä¸æ ‡å‡†

- å•å…ƒæµ‹è¯•ï¼šä¼˜å…ˆè¦†ç›–æ¨¡å‹æ ¡éªŒã€å†²çªæ£€æµ‹ã€è°ƒåº¦ç®—æ³•ï¼›LLM ä½¿ç”¨ mockã€‚
- é›†æˆæµ‹è¯•ï¼šAPI ä¸»é“¾è·¯ï¼ˆè§£æ â†’ è°ƒåº¦ï¼‰ã€‚
- å‰ç«¯æ‰‹æµ‹ï¼šè¡¨å•è¾“å…¥ â†’ è§£æç»“æœ â†’ è§„åˆ’ç»“æœã€‚
- é€šè¿‡æ ‡å‡†ï¼šæ ¸å¿ƒç”¨ä¾‹å…¨ç»¿ï¼›é”™è¯¯è·¯å¾„æœ‰æ¸…æ™°æç¤ºã€‚

### æ•°æ®æŒä¹…åŒ–ï¼ˆå¯é€‰ä½†æ¨èï¼‰

- MVPï¼šå†…å­˜æˆ– JSON æ–‡ä»¶
- æ¨èï¼šSQLite + SQLAlchemy + Alembicï¼Œåç»­æ— ç¼åˆ‡æ¢ Postgres
- æµ‹è¯•ï¼šä»“å‚¨å±‚ CRUD å•æµ‹ã€API é›†æˆæµ‹ï¼ˆåˆ›å»º/æŸ¥è¯¢ä»»åŠ¡ï¼‰

### è·¯çº¿å›¾

- v0ï¼šMVPï¼ˆè§£æã€è°ƒåº¦ã€åå¥½ä¸çŠ¶æ€ã€åŸºç¡€å‰ç«¯ï¼‰
- v1ï¼šICSã€æŒä¹…åŒ–ã€æ›´å¤šå¯è§†åŒ–
- v2ï¼šç¬¬ä¸‰æ–¹æ—¥å†åŒå‘åŒæ­¥ã€åå¥½è‡ªåŠ¨å­¦ä¹ ã€å›¢é˜ŸååŒ

### è´¡çŒ®

æ¬¢è¿é€šè¿‡ Issue/PR æäº¤æ”¹è¿›å»ºè®®æˆ–å®ç°åŠŸèƒ½ã€‚
